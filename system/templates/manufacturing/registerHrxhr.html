{% extends "base.html" %}

{% block title %} Hora por hora {% endblock %}

{% block content %}

<div class="page-title"> Registrar hora por hora </div>
<div class="page-subtitle"> Registre los modelos y su cantidad total a producir por hora el d√≠a de hoy. </div>

<!-- üîç DEBUG TEMPORAL -->
<div style="background: #fffacd; padding: 15px; margin: 15px; border: 2px solid #ffa500;">
    <h3>üîç DEBUG INFO</h3>
    <p><strong>Total forms:</strong> {{ formset.forms|length }}</p>
    <p><strong>Verificando field.queryset directamente:</strong></p>
    {% with first_form=formset.forms.0 %}
        {% if first_form.production_detail.field.queryset.all %}
            <p style="color: green;">‚úÖ Hay {{ first_form.production_detail.field.queryset.all|length }} opciones</p>
            <ul>
                {% for choice in first_form.production_detail.field.queryset.all %}
                    <li>{{ choice.id }} - {{ choice }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p style="color: red;">‚ùå A√∫n no hay opciones</p>
        {% endif %}
    {% endwith %}
</div>
<!-- FIN DEBUG -->

<div class="card">
    <p class="card-title"> Hora por hora </p>
    <form method="POST">
            <table class="table">
                <tr style="text-align: center;">
                    <th style="text-align: center;"> Hora </th>
                    <th style="text-align: center;"> Modelo </th>
                    <th style="text-align: center;"> Cantidad </th>
                </tr>
                {% csrf_token %}
                {{ formset.management_form }}
                {% for f in formset %}
                        <tr>
                            <td style="text-align: center;"> {{ f.hour }} </td>
                            <td style="text-align: center;"> 
                                {{ f.production_detail }}
                                <!-- Debug: cu√°ntas opciones tiene este select -->
                                <small style="color: #999; display: block; font-size: 10px;">
                                    {% if f.production_detail.field.queryset.all %}
                                        {{ f.production_detail.field.queryset.all|length }} opciones
                                    {% else %}
                                        0 opciones
                                    {% endif %}
                                </small>
                            </td>
                            <td style="text-align: center;"> {{ f.pieces }} </td>
                        </tr>
                {% endfor %}
            </table>

            <div style="justify-self: flex-end; margin-right: 15px; margin-bottom: 10px;">
                <button class="btn btn-outline" type="submit"> Guardar hora por hora </button> 
            </div>
    </form>
</div>

{% endblock %}